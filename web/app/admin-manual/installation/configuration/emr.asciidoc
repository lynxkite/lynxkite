[[emr-file]]
### The EMR specifications file

This file contains various configurations used when launching LynxKite on Amazon Elastic
MapReduce (EMR).

Specify the name of the cluster.
```
CLUSTER_NAME=${USER}-cluster
```

Set the number of nodes in the cluster.
```
NUM_INSTANCES=3
```

Set the number of executors running in the cluster.
```
NUM_EXECUTORS=3
```

Specify the type of the instance to create.
```
TYPE=m3.2xlarge
```

Specify the id of the SSH key that you want to use to connect to the cluster.
```
SSH_ID=lynx-cli
```

Specify the private key file for the ID above.
```
SSH_KEY=${HOME}/.ssh/lynx-cli.pem
```

Specify in which region the cluster should run.
```
REGION=us-east-1
```

The configurations below are determined by the instance type above, however it is still required
to fill them. See the EMR
http://docs.aws.amazon.com/ElasticMapReduce/latest/DeveloperGuide/TaskConfiguration_H2.html[task configuration]
documentation for memory limits and the EC2 https://aws.amazon.com/ec2/instance-types/[instance types]
documentation for number of cores.
```
CORES=8
# YARN limit minus overhead minus 1GB so that the application master fits on one machine.
USE_RAM_GB=18
```

The local temp directory is a local path that exists on all workers and the master and will
be used for storing temporary Spark/Hadoop files. This directory can potentially use a lot of
space, so if you have a small root filesystem and an extra large drive mounted somewhere then you
need to point this to somewhere on the large drive. On the other hand performance of this drive has
a significant effect on overall speed, so using an SSD is a nice option here.
```
LOCAL_TMP_DIR=/mnt/tmp
```

Another possible working configuration:
```
# TYPE=m1.large
# CORES=2
# USE_RAM_GB=3
# LOCAL_TMP_DIR=/mnt/tmp
```

Specify the S3 directory to store graph data in without the `s3://` prefix. It must use the
same credentials as the user starting the cluster. Used as the backup location with the
`s3copy` command. This needs to be in the same region as `REGION`. Or you get charged by Amazon.
```
S3_DATAREPO=lynx-bnw-data/${USER}-cluster
```

Extra parameters passed to the Amazon `aws emr create-cluster` command. You can configure
for example logging and Amazon EC2 debugging here.
```
CREATE_CLUSTER_EXTRA_PARAMS="--log-uri s3n://${S3_DATAREPO}/emr-logs/ --enable-debugging"
```

Specify additional EC2 attributes here. For example for deployment in a VPC private subnet, you'll
need to set SubnetId and AdditionalMasterSecurityGroups. E.g.:
`CREATE_CLUSTER_EXTRA_EC2_ATTRS='"SubnetId": "subnet-XXXX","AdditionalMasterSecurityGroups":["sg-YYYY"]'`
```
CREATE_CLUSTER_EXTRA_EC2_ATTRS=""
```

In most cases, `aws` command line tools rely on the presence on `AWS_ACCESS_KEY_ID` and `AWS_SECRET_ACCESS_KEY`.
However, this is not always necessary (e.g., when an emr cluster and the start script reside
in the same VPN). Uncomment the following line to configure this situation:
```
# AWS_NO_KEY=1
```

The list of applications needed on the cluster:
```
# EMR_APPLICATIONS="Name=Hadoop Name=Ganglia Name=Hive Name=Hue Name=Spark"
EMR_APPLICATIONS="Name=Hadoop"
```

The release label for the emr cluster to be created:
```
EMR_RELEASE_LABEL=emr-5.2.0
```

The service role. The default service role works fine, unless the cluster is in a private subnet:
```
EMR_SERVICE_ROLE=EMR_DefaultRole
```

The person responsible for the cluster.
```
EMR_OWNER=${EMR_OWNER:-$USER}
```

The expected expiry date for the cluster. in YYYYMMDD format. It defaults to the next day.
```
EXPIRY=`date --date="tomorrow"  +"%Y%m%d"`
```

The cluster name, it's owner, and the expiry date is added as a tag to
the emr cluster. Additional tags can also be specified:
EMR_TAGS=( Name=${CLUSTER_NAME} owner=${EMR_OWNER} expiry=${EXPIRY} Department='My Department' Project='My project')
```
EMR_TAGS=( Name=${CLUSTER_NAME} owner=${EMR_OWNER} expiry=${EXPIRY})
```

By default, emr.sh installs Spark by downloading an official version from cloudfront.net
directly to the master machine. This may be undesired in a Virtual Private Cluster setup,
where the master has no Internet access. In such cases, setting the below flag to "local"
tells emr.sh to upload the local Spark installation instead.

```
# DEPLOY_SPARK_FROM=local
```

Provides a part of the name for the `KITE_INSTANCE` variable that identifies the instance. E.g.,
leaving it at the default `emr` could result in such name: `emr-3e-4i-m3.2xlarge-8cores-18g`.
(The `KITE_INSTANCE` variable is assembled like this:
`${KITE_INSTANCE_BASE_NAME}-${NUM_EXECUTORS}e-${NUM_INSTANCES}i-${TYPE}-${CORES}cores-${USE_RAM_GB}g`)


```
KITE_INSTANCE_BASE_NAME=emr
```
